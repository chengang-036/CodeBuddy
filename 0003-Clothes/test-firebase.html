<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase è¿æ¥æµ‹è¯•</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-item {
            padding: 15px;
            margin: 10px 0;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #ccc;
        }
        .test-item.success {
            border-color: #28a745;
        }
        .test-item.error {
            border-color: #dc3545;
        }
        .test-item.warning {
            border-color: #ffc107;
        }
        h1 { color: #333; }
        pre { 
            background: #f8f9fa; 
            padding: 10px; 
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Firebase è¿æ¥æµ‹è¯•</h1>
    <div id="results"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="firebase-config.js"></script>

    <script>
        const results = document.getElementById('results');

        function addResult(title, status, message, data) {
            const div = document.createElement('div');
            div.className = 'test-item ' + status;
            div.innerHTML = `
                <h3>${status === 'success' ? 'âœ…' : status === 'error' ? 'âŒ' : 'âš ï¸'} ${title}</h3>
                <p>${message}</p>
                ${data ? '<pre>' + JSON.stringify(data, null, 2) + '</pre>' : ''}
            `;
            results.appendChild(div);
        }

        async function runTests() {
            // æµ‹è¯• 1: Firebase åˆå§‹åŒ–
            try {
                if (firebase.apps.length > 0) {
                    addResult('Firebase åˆå§‹åŒ–', 'success', 'Firebase å·²æˆåŠŸåˆå§‹åŒ–', {
                        projectId: firebase.apps[0].options.projectId,
                        storageBucket: firebase.apps[0].options.storageBucket
                    });
                } else {
                    addResult('Firebase åˆå§‹åŒ–', 'error', 'Firebase æœªåˆå§‹åŒ–');
                    return;
                }
            } catch (error) {
                addResult('Firebase åˆå§‹åŒ–', 'error', error.message);
                return;
            }

            // æµ‹è¯• 2: Firestore è¿æ¥
            try {
                addResult('Firestore æµ‹è¯•', 'warning', 'æ­£åœ¨æµ‹è¯• Firestore è¿æ¥...');
                const testDoc = await db.collection('clothes').limit(1).get();
                addResult('Firestore è¿æ¥', 'success', 
                    `æˆåŠŸè¿æ¥åˆ° Firestoreï¼å·²æœ‰ ${testDoc.size} æ¡æ•°æ®`);
            } catch (error) {
                addResult('Firestore è¿æ¥', 'error', 
                    'æ— æ³•è¿æ¥åˆ° Firestore: ' + error.message, 
                    { code: error.code, details: error.toString() });
            }

            // æµ‹è¯• 3: Storage è¿æ¥
            try {
                addResult('Storage æµ‹è¯•', 'warning', 'æ­£åœ¨æµ‹è¯• Storage è¿æ¥...');
                const storageRef = storage.ref();
                const bucket = storage.app.options.storageBucket;
                addResult('Storage è¿æ¥', 'success', 
                    'Storage å·²é…ç½®', 
                    { bucket: bucket });
            } catch (error) {
                addResult('Storage è¿æ¥', 'error', 
                    'æ— æ³•è®¿é—® Storage: ' + error.message);
            }

            // æµ‹è¯• 4: å†™å…¥æµ‹è¯•
            try {
                addResult('å†™å…¥æµ‹è¯•', 'warning', 'æ­£åœ¨æµ‹è¯•å†™å…¥æƒé™...');
                const testData = {
                    test: true,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                };
                await db.collection('clothes').doc('test_write').set(testData);
                addResult('å†™å…¥æµ‹è¯•', 'success', 'æˆåŠŸå†™å…¥æµ‹è¯•æ•°æ®åˆ° Firestore');
                
                // æ¸…ç†æµ‹è¯•æ•°æ®
                await db.collection('clothes').doc('test_write').delete();
            } catch (error) {
                addResult('å†™å…¥æµ‹è¯•', 'error', 
                    'å†™å…¥å¤±è´¥ï¼ˆå¯èƒ½æ˜¯æƒé™é—®é¢˜ï¼‰: ' + error.message,
                    { 
                        code: error.code,
                        hint: 'è¯·æ£€æŸ¥ Firestore å®‰å…¨è§„åˆ™æ˜¯å¦å…è®¸å†™å…¥'
                    });
            }

            // æµ‹è¯• 5: Storage ä¸Šä¼ æµ‹è¯•
            try {
                addResult('Storage ä¸Šä¼ æµ‹è¯•', 'warning', 'æ­£åœ¨æµ‹è¯•ä¸Šä¼ æƒé™...');
                const testBlob = new Blob(['test'], { type: 'text/plain' });
                const testRef = storage.ref('test/test.txt');
                await testRef.put(testBlob);
                addResult('Storage ä¸Šä¼ ', 'success', 'æˆåŠŸä¸Šä¼ æµ‹è¯•æ–‡ä»¶åˆ° Storage');
                
                // æ¸…ç†æµ‹è¯•æ–‡ä»¶
                await testRef.delete();
            } catch (error) {
                addResult('Storage ä¸Šä¼ ', 'error', 
                    'ä¸Šä¼ å¤±è´¥ï¼ˆå¯èƒ½æ˜¯æƒé™é—®é¢˜ï¼‰: ' + error.message,
                    { 
                        code: error.code,
                        hint: 'è¯·æ£€æŸ¥ Storage å®‰å…¨è§„åˆ™æ˜¯å¦å…è®¸å†™å…¥'
                    });
            }

            addResult('æµ‹è¯•å®Œæˆ', 'success', 'æ‰€æœ‰æµ‹è¯•å·²å®Œæˆï¼Œè¯·æ£€æŸ¥ä¸Šè¿°ç»“æœ');
        }

        // å»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿ Firebase å®Œå…¨åŠ è½½
        setTimeout(runTests, 1000);
    </script>
</body>
</html>
